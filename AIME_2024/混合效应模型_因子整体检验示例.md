# 混合效应模型：因子整体检验功能说明

## 功能概述

混合效应模型现在**同时支持两种报告方式**：

1. **因子整体检验**（类似 ANOVA）- 新增功能
2. **水平具体效应**（原有功能）

## 输出示例

运行 `get_mix_effect.py` 后，输出文件会包含两个部分：

### 第一部分：水平具体效应（原有功能）

```
---- Fixed Effects (sorted by p-value, then |Estimate|) ----
                       Estimate Std. Error     z value      Pr(>|z|)
(Intercept)         -1.11096490 0.35341126  -3.1435470  1.669136e-03
cot1                -1.59328789 0.04551083 -35.0089829 1.642388e-268
question_type1      -0.81807926 0.04315052 -18.9587363  3.740228e-80
max_tokens4000       0.78904415 0.05292133  14.9097563  2.847899e-50
max_tokens100        0.19273432 0.05245571   3.6742295  2.385683e-04
...
```

**解读**：每个水平的具体效应（如 `cot1`, `max_tokens4000`）

### 第二部分：因子整体检验（新增功能）✨

```
---- Overall Factor Significance (Likelihood Ratio Test) ----
Testing each factor as a whole (similar to ANOVA)
Method: drop1() - compares full model vs model without each factor

Factor            Df    AIC      LRT      Pr(>Chi)  Relative_Importance
------------------------------------------------------------------------
cot                1    14250    1250.5   0.000000   0.4500
question_type      1    14280    980.2    0.000000   0.3500
max_tokens         3    14290    120.5    0.000000   0.0430
language           5    14300    85.3     0.000000   0.0307
Temperature        2    14310    45.2     0.000000   0.0163
top_p              2    14315    35.1     0.000012   0.0126
few                1    14320    25.8     0.000001   0.0093
presence_penalty    2    14325    18.5     0.000098   0.0067
mul                1    14328    12.3     0.000450   0.0044
question_tran      1    14330    8.2      0.004200   0.0030

Note: Relative_Importance is similar to ANOVA's eta² - the proportion of total LRT explained by each factor.
      Higher values indicate more important factors.
```

**解读**：
- **Factor**：因子名称（整体，不区分水平）
- **Df**：自由度（因子有多少个水平 - 1）
- **LRT**：似然比统计量（越大越重要）
- **Pr(>Chi)**：p 值（判断是否显著）
- **Relative_Importance**：相对重要性（类似 ANOVA 的 eta²）

## 与 ANOVA 对比

| 指标 | ANOVA | Mixed Effects (整体检验) |
|------|-------|-------------------------|
| **统计量** | eta² | Relative_Importance |
| **检验方法** | F 检验 | 似然比检验 (LRT) |
| **输出格式** | 每个因子 1 行 | 每个因子 1 行 |
| **回答的问题** | "这个因子重要吗？" | "这个因子重要吗？" |

**示例对比**：

**ANOVA 输出**（`deepseekv3.log`）：
```
factor              obs_eta2    p_value
Question Format     0.399643    0.000000
COT                 0.080156    0.000000
max_tokens          0.028099    0.000000
```

**Mixed Effects 整体检验输出**（新增）：
```
Factor            Relative_Importance  Pr(>Chi)
question_type     0.3500              0.000000
cot               0.4500              0.000000
max_tokens        0.0430              0.000000
```

两者都回答："这个因子重要吗？"，但使用不同的统计方法。

## 使用建议

1. **因子筛选**：使用"因子整体检验"部分，快速找出重要因子
2. **具体优化**：使用"水平具体效应"部分，了解每个取值的影响
3. **完整分析**：两部分结合使用，既有整体视角，又有细节信息

## 技术细节

- **方法**：使用 R 的 `drop1()` 函数进行似然比检验
- **原理**：比较完整模型 vs 去掉该因子后的模型
- **优势**：适用于混合效应模型，考虑了随机效应的影响
- **限制**：需要模型收敛良好，某些复杂模型可能无法计算

## 总结

✅ **混合效应模型现在可以同时提供**：
- 因子整体检验（类似 ANOVA）
- 水平具体效应（ANOVA 无法提供）

这使得混合效应模型成为更全面的分析工具！
